<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.io Test</title>
  
  <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    #chatContent {
      border: 1px solid #000;
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      overflow-y: auto;
    }

    #myChat {
      width: 100%;
    }
  </style>
</head>

<body>
  <%= title %>

  <div id="chatContent"></div>
  <input type="text" id="msg" style="width: 200px;">
  <input type="button" id="sendMsg" value="전송"></input>

  <script>
          window.onload = function() {

    const roomId = "<%= roomId %>";
    console.log(roomId);
    const socket =  io.connect("http://localhost:4042/chat");

    const user = "user";

    socket.emit("joinRoom",{ roomId, user });
        
            // 버튼 클릭 
            document.getElementById("sendMsg").onclick = function() {
              console.log("sendMsg");
                      
                const data = document.getElementById('msg').value;
                console.log("sendMessage : " + data);

                socket.emit("msg", {
                  roomId : roomId,
                  user: user,
                  data: data
                })

            
          }
            
            socket.on('msg', (data) => {
              $("#chatContent").append("<div>" + data.user + " :  " + data.data + "</div>");
            });
   
          }

  </script>
</body>

</html>
